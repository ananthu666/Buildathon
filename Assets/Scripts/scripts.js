var Data1 = {
    "columns": [
        { "key": "id", "header": "ID" },
        { "key": "firstName", "header": "First Name" },
        { "key": "lastName", "header": "Last Name" },
        { "key": "email", "header": "Email" },
        { "key": "department", "header": "Department" },
        // { "key": "status", "header": "Current Status" }
    ],
    "status": {
    "Active": "green",
    "On Leave": "red",
    "Inactive": "yellow",
    "Terminated": "danger",
    "Suspended": "warning"
},
    "bodyel": [
        {
            "id": 1,
            "firstName": "John",
            "lastName": "Smith",
            "email": "john.smith@email.com",
            "department": "Marketing",
            "status": "Active"
        },
        {
            "id": 2,
            "firstName": "Sarah",
            "lastName": "Johnson",
            "email": "sarah.j@email.com",
            "department": "Development",
            "status": "Active"
        },
        {
            "id": 3,
            "firstName": "Michael",
            "lastName": "Wilson",
            "email": "m.wilson@email.com",
            "department": "Sales",
            "status": "On Leave"
        },
        {
            "id": 4,
            "firstName": "Emily",
            "lastName": "Brown",
            "email": "emily.b@email.com",
            "department": "HR",
            "status": "Active"
        },
        {
            "id": 5,
            "firstName": "David",
            "lastName": "Lee",
            "email": "david.lee@email.com",
            "department": "Development",
            "status": "Inactive"
        }
    ]
};
 

 var Data2 = {
    "columns": [
        { "key": "id", "header": "ID" },
        { "key": "firstName", "header": "First Name" },
        { "key": "lastName", "header": "Last Name" },
        { "key": "email", "header": "Email" },
        { "key": "major", "header": "Major" },
        { "key": "year", "header": "Year" },
       
        { "key": "gpa", "header": "GPA" },
        // { "key": "status", "header": "Current Status" }
    ],
    "status": {
        "Active": "green",
        "Graduated": "blue",
        "On Leave": "red",
        "Inactive": "yellow"
    },
    "bodyel": [
        {
            "id": 1,
            "firstName": "Alice",
            "lastName": "Johnson",
            "email": "alice.johnson@email.com",
            "major": "Computer Science",
            "year": "Sophomore",
            "gpa": 3.8,
            "status": "Active"
        },
        {
            "id": 2,
            "firstName": "Bob",
            "lastName": "Smith",
            "email": "bob.smith@email.com",
            "major": "Mathematics",
            "year": "Freshman",
            "gpa": 3.5,
            "status": "Active"
        },
        {
            "id": 3,
            "firstName": "Charlie",
            "lastName": "Davis",
            "email": "charlie.davis@email.com",
            "major": "Biology",
            "year": "Junior",
            "gpa": 2.9,
            "status": "On Leave"
        },
        {
            "id": 4,
            "firstName": "Diana",
            "lastName": "Williams",
            "email": "diana.williams@email.com",
            "major": "Chemistry",
            "year": "Senior",
            "gpa": 3.9,
            "status": "Graduated"
        },
        {
            "id": 5,
            "firstName": "Ethan",
            "lastName": "Taylor",
            "email": "ethan.taylor@email.com",
            "major": "Physics",
            "year": "Senior",
            "gpa": 2.7,
            "status": "Inactive"
        },
        {
            "id": 6,
            "firstName": "Fay",
            "lastName": "Martinez",
            "email": "fay.martinez@email.com",
            "major": "Engineering",
            "year": "Freshman",
            "gpa": 3.2,
            "status": "Active"
        },
        {
            "id": 7,
            "firstName": "George",
            "lastName": "Brown",
            "email": "george.brown@email.com",
            "major": "Psychology",
            "year": "Sophomore",
            "gpa": 3.6,
            "status": "Active"
        },
        {
            "id": 8,
            "firstName": "Hannah",
            "lastName": "Garcia",
            "email": "hannah.garcia@email.com",
            "major": "English Literature",
            "year": "Junior",
            "gpa": 3.1,
            "status": "On Leave"
        },
        {
            "id": 9,
            "firstName": "Isaac",
            "lastName": "Lopez",
            "email": "isaac.lopez@email.com",
            "major": "History",
            "year": "Senior",
            "gpa": 2.8,
            "status": "Graduated"
        },
        {
            "id": 10,
            "firstName": "Jack",
            "lastName": "Martinez",
            "email": "jack.martinez@email.com",
            "major": "Sociology",
            "year": "Senior",
            "gpa": 3.4,
            "status": "Inactive"
        },
        {
            "id": 11,
            "firstName": "Kelly",
            "lastName": "Adams",
            "email": "kelly.adams@email.com",
            "major": "Economics",
            "year": "Freshman",
            "gpa": 3.7,
            "status": "Active"
        },
        {
            "id": 12,
            "firstName": "Liam",
            "lastName": "Carter",
            "email": "liam.carter@email.com",
            "major": "Philosophy",
            "year": "Sophomore",
            "gpa": 3.3,
            "status": "Active"
        },
        {
            "id": 13,
            "firstName": "Mia",
            "lastName": "Rodriguez",
            "email": "mia.rodriguez@email.com",
            "major": "Political Science",
            "year": "Junior",
            "gpa": 3.5,
            "status": "On Leave"
        },
        {
            "id": 14,
            "firstName": "Noah",
            "lastName": "Hernandez",
            "email": "noah.hernandez@email.com",
            "major": "Art History",
            "year": "Senior",
            "gpa": 3.2,
            "status": "Graduated"
        },
        {
            "id": 15,
            "firstName": "Olivia",
            "lastName": "Gonzalez",
            "email": "olivia.gonzalez@email.com",
            "major": "Environmental Science",
            "year": "Senior",
            "gpa": 3.8,
            "status": "Active"
        },
        {
            "id": 16,
            "firstName": "Paul",
            "lastName": "Nelson",
            "email": "paul.nelson@email.com",
            "major": "Business Administration",
            "year": "Freshman",
            "gpa": 2.9,
            "status": "Inactive"
        },
        {
            "id": 17,
            "firstName": "Quinn",
            "lastName": "Mitchell",
            "email": "quinn.mitchell@email.com",
            "major": "Music",
            "year": "Sophomore",
            "gpa": 3.4,
            "status": "Active"
        },
        {
            "id": 18,
            "firstName": "Rachel",
            "lastName": "Perez",
            "email": "rachel.perez@email.com",
            "major": "Theater Arts",
            "year": "Junior",
            "gpa": 3.0,
            "status": "On Leave"
        },
        {
            "id": 19,
            "firstName": "Samuel",
            "lastName": "Wright",
            "email": "samuel.wright@email.com",
            "major": "Computer Engineering",
            "year": "Senior",
            "gpa": 3.9,
            "status": "Graduated"
        },
        {
            "id": 20,
            "firstName": "Tina",
            "lastName": "Scott",
            "email": "tina.scott@email.com",
            "major": "Nursing",
            "year": "Senior",
            "gpa": 3.6,
            "status": "Inactive"
        }
    ]
};

var Data3=
{
    "columns": [
        { "key": "id", "header": "ID" },
        { "key": "firstName", "header": "First Name" },
        { "key": "lastName", "header": "Last Name" },
        { "key": "email", "header": "Email" },
        { "key": "major", "header": "Major" },
        { "key": "year", "header": "Year" },
        { "key": "gpa", "header": "GPA" },
        // { "key": "status", "header": "Current Status" },
        { "key": "phone", "header": "Phone Number" },
        { "key": "address", "header": "Address" },
        { "key": "dob", "header": "Date of Birth" },
        { "key": "enrollmentDate", "header": "Enrollment Date" },
        { "key": "graduationDate", "header": "Expected Graduation Date" }
    ],
    "status": {
        "Active": "green",
        "Graduated": "blue",
        "On Leave": "red",
        "Inactive": "yellow"
    },
    "bodyel": [
        {
            "id": 1,
            "firstName": "Alice",
            "lastName": "Johnson",
            "email": "alice.johnson@email.com",
            "major": "Computer Science",
            "year": "Sophomore",
            "gpa": 3.8,
            "status": "Active",
            "phone": "123-456-7890",
            "address": "123 Main St, Cityville, CA",
            "dob": "2002-05-15",
            "enrollmentDate": "2020-09-01",
            "graduationDate": "2024-06-15"
        },
        {
            "id": 2,
            "firstName": "Bob",
            "lastName": "Smith",
            "email": "bob.smith@email.com",
            "major": "Mathematics",
            "year": "Freshman",
            "gpa": 3.5,
            "status": "Active",
            "phone": "234-567-8901",
            "address": "456 Elm St, Townsville, NY",
            "dob": "2003-08-21",
            "enrollmentDate": "2021-09-01",
            "graduationDate": "2025-06-15"
        },
        {
            "id": 3,
            "firstName": "Charlie",
            "lastName": "Davis",
            "email": "charlie.davis@email.com",
            "major": "Biology",
            "year": "Junior",
            "gpa": 2.9,
            "status": "On Leave",
            "phone": "345-678-9012",
            "address": "789 Oak St, Villageton, TX",
            "dob": "2001-04-11",
            "enrollmentDate": "2019-09-01",
            "graduationDate": "2023-06-15"
        },
        {
            "id": 4,
            "firstName": "Emma",
            "lastName": "Rodriguez",
            "email": "emma.rodriguez@email.com",
            "major": "Computer Science",
            "year": "Senior",
            "gpa": 3.7,
            "status": "Active",
            "phone": "123-456-7890",
            "address": "456 Pine Lane, Collegetown, CA",
            "dob": "2000-09-15",
            "enrollmentDate": "2020-01-15",
            "graduationDate": "2024-05-30"
        },
        {
            "id": 5,
            "firstName": "Liam",
            "lastName": "Chen",
            "email": "liam.chen@email.com",
            "major": "Electrical Engineering",
            "year": "Sophomore",
            "gpa": 3.4,
            "status": "Active",
            "phone": "234-567-8901",
            "address": "222 Maple Road, Techville, WA",
            "dob": "2003-11-22",
            "enrollmentDate": "2021-09-01",
            "graduationDate": "2025-06-15"
        },
        {
            "id": 6,
            "firstName": "Charlie",
            "lastName": "Davis",
            "email": "charlie.davis@email.com",
            "major": "Biology",
            "year": "Junior",
            "gpa": 2.9,
            "status": "On Leave",
            "phone": "345-678-9012",
            "address": "789 Oak St, Villageton, TX",
            "dob": "2001-04-11",
            "enrollmentDate": "2019-09-01",
            "graduationDate": "2023-06-15"
        },
        {
            "id": 7,
            "firstName": "Sophia",
            "lastName": "Kim",
            "email": "sophia.kim@email.com",
            "major": "Psychology",
            "year": "Senior",
            "gpa": 3.6,
            "status": "Active",
            "phone": "456-789-0123",
            "address": "567 Birch Street, Mindtown, NY",
            "dob": "1999-07-30",
            "enrollmentDate": "2019-01-15",
            "graduationDate": "2024-05-30"
        },
        {
            "id": 8,
            "firstName": "Marcus",
            "lastName": "Williams",
            "email": "marcus.williams@email.com",
            "major": "Business Administration",
            "year": "Junior",
            "gpa": 3.2,
            "status": "Active",
            "phone": "567-890-1234",
            "address": "345 Cedar Avenue, Businessburg, IL",
            "dob": "2001-12-05",
            "enrollmentDate": "2020-09-01",
            "graduationDate": "2024-06-15"
        },
        {
            "id": 9,
            "firstName": "Olivia",
            "lastName": "Lee",
            "email": "olivia@gmail.com",
            "major": "Art",
            "year": "Senior",
            "gpa": 3.9,
            "status": "Graduated",
            "phone": "678-901-2345",
            "address": "678 Pine Street, Artville, CA",
            "dob": "1999-02-20",
            "enrollmentDate": "2019-01-15",
            "graduationDate": "2023-05-30"
        },
        {
            "id": 10,
            "firstName": "Ethan",
            "lastName": "Taylor",
            "email": "ethan@gmail.com",
            "major": "Physics",
            "year": "Senior",
            "gpa": 2.7,
            "status": "Inactive",
            "phone": "789-012-3456",
            "address": "789 Elm Road, Physicstown, WA",
            "dob": "1999-11-15",
            "enrollmentDate": "2019-09-01",
            "graduationDate": "2023-05-30"
        },
        {
            "id": 11,
            "firstName": "Fay",
            "lastName": "Martinez",
            "email": "fay@gmail.com",
            "major": "Engineering",
            "year": "Freshman",
            "gpa": 3.2,
            "status": "Active",
            "phone": "123-456-7890",
            "address": "123 Main St, Cityville, CA",
            "dob": "2002-05-15",
            "enrollmentDate": "2020-09-01",
            "graduationDate": "2024-06-15"
        },
        {
            "id": 12,
            "firstName": "Grace",
            "lastName": "Wong",
            "email": "grace.wong@university.edu",
            "major": "Environmental Science",
            "year": "Sophomore",
            "gpa": 3.6,
            "status": "Active",
            "phone": "987-654-3210",
            "address": "456 River Road, Greenville, OR",
            "dob": "2003-03-25",
            "enrollmentDate": "2021-01-15",
            "graduationDate": "2025-05-30"
        },
        {
            "id": 13,
            "firstName": "Miguel",
            "lastName": "Santos",
            "email": "miguel.santos@university.edu",
            "major": "International Relations",
            "year": "Junior",
            "gpa": 3.3,
            "status": "Active",
            "phone": "456-123-7890",
            "address": "234 Global Avenue, Diplomaville, DC",
            "dob": "2001-09-10",
            "enrollmentDate": "2020-09-01",
            "graduationDate": "2024-06-15"
        },
        {
            "id": 14,
            "firstName": "Rachel",
            "lastName": "Cohen",
            "email": "rachel.cohen@university.edu",
            "major": "Neuroscience",
            "year": "Senior",
            "gpa": 3.8,
            "status": "Active",
            "phone": "345-678-9012",
            "address": "789 Brain Street, Sciencetown, MA",
            "dob": "2000-06-18",
            "enrollmentDate": "2019-09-01",
            "graduationDate": "2024-05-30"
        },
        {
            "id": 15,
            "firstName": "Ahmed",
            "lastName": "Hassan",
            "email": "ahmed.hassan@university.edu",
            "major": "Chemical Engineering",
            "year": "Freshman",
            "gpa": 3.1,
            "status": "Active",
            "phone": "678-901-2345",
            "address": "567 Innovation Lane, Researchburg, TX",
            "dob": "2004-01-30",
            "enrollmentDate": "2022-01-15",
            "graduationDate": "2026-05-30"
        },
        {
            "id": 16,
            "firstName": "Isabella",
            "lastName": "Garcia",
            "email": "isabella.garcia@university.edu",
            "major": "Architecture",
            "year": "Senior",
            "gpa": 3.5,
            "status": "Active",
            "phone": "234-567-8901",
            "address": "890 Design Street, Buildcity, CA",
            "dob": "2000-11-12",
            "enrollmentDate": "2019-09-01",
            "graduationDate": "2024-05-30"
        },
        {
            "id": 17,
            "firstName": "Noah",
            "lastName": "Peterson",
            "email": "noah.peterson@university.edu",
            "major": "Mechanical Engineering",
            "year": "Sophomore",
            "gpa": 3.3,
            "status": "Active",
            "phone": "345-678-9012",
            "address": "456 Innovation Road, Techville, WA",
            "dob": "2003-07-22",
            "enrollmentDate": "2021-09-01",
            "graduationDate": "2025-06-15"
        },
        {
            "id": 18,
            "firstName": "Zara",
            "lastName": "Khan",
            "email": "zara.khan@university.edu",
            "major": "Anthropology",
            "year": "Junior",
            "gpa": 3.7,
            "status": "Active",
            "phone": "456-789-0123",
            "address": "234 Culture Lane, Studyville, NY",
            "dob": "2001-03-05",
            "enrollmentDate": "2020-09-01",
            "graduationDate": "2024-06-15"
        },
        {
            "id": 19,
            "firstName": "Daniel",
            "lastName": "Mueller",
            "email": "daniel.mueller@university.edu",
            "major": "Economics",
            "year": "Senior",
            "gpa": 3.6,
            "status": "Active",
            "phone": "567-890-1234",
            "address": "678 Finance Avenue, Markettown, IL",
            "dob": "2000-09-18",
            "enrollmentDate": "2019-01-15",
            "graduationDate": "2024-05-30"
        },
        {
            "id": 20,
            "firstName": "Aria",
            "lastName": "Patel",
            "email": "aria.patel@university.edu",
            "major": "Biotechnology",
            "year": "Freshman",
            "gpa": 3.9,
            "status": "Active",
            "phone": "678-901-2345",
            "address": "345 Science Park, Genometown, MA",
            "dob": "2004-06-30",
            "enrollmentDate": "2022-09-01",
            "graduationDate": "2026-06-15"
        },
        {
            "id": 21,
            "firstName": "Ryan",
            "lastName": "Thompson",
            "email": "ryan.thompson@university.edu",
            "major": "Film Studies",
            "year": "Junior",
            "gpa": 3.4,
            "status": "Active",
            "phone": "789-012-3456",
            "address": "567 Cinema Street, Hollywoodville, CA",
            "dob": "2001-12-07",
            "enrollmentDate": "2020-09-01",
            "graduationDate": "2024-06-15"
        },
        {
            "id": 22,
            "firstName": "Elena",
            "lastName": "Rodriguez",
            "email": "elena.rodriguez@university.edu",
            "major": "Linguistics",
            "year": "Senior",
            "gpa": 3.8,
            "status": "Active",
            "phone": "890-123-4567",
            "address": "123 Language Lane, Wordsburg, TX",
            "dob": "2000-04-25",
            "enrollmentDate": "2019-09-01",
            "graduationDate": "2024-05-30"
        },
        {
            "id": 23,
            "firstName": "Samuel",
            "lastName": "Kim",
            "email": "samuel.kim@university.edu",
            "major": "Data Science",
            "year": "Sophomore",
            "gpa": 3.5,
            "status": "Active",
            "phone": "901-234-5678",
            "address": "456 Analytics Road, Dataville, WA",
            "dob": "2003-10-15",
            "enrollmentDate": "2021-09-01",
            "graduationDate": "2025-06-15"
        },
        {
            "id": 24,
            "firstName": "Mia",
            "lastName": "Nguyen",
            "email": "mia.nguyen@university.edu",
            "major": "Public Health",
            "year": "Junior",
            "gpa": 3.6,
            "status": "Active",
            "phone": "012-345-6789",
            "address": "789 Wellness Street, Healthtown, CA",
            "dob": "2001-08-03",
            "enrollmentDate": "2020-09-01",
            "graduationDate": "2024-06-15"
        },
        {
            "id": 25,
            "firstName": "Lucas",
            "lastName": "Morales",
            "email": "lucas.morales@university.edu",
            "major": "Robotics Engineering",
            "year": "Senior",
            "gpa": 3.7,
            "status": "Active",
            "phone": "123-456-7890",
            "address": "234 Innovation Drive, Techburg, MI",
            "dob": "2000-01-20",
            "enrollmentDate": "2019-09-01",
            "graduationDate": "2024-05-30"
        }
        

        
    ]
};

var Data=Data3;
// console.log(Data);

const table = document.getElementById('resizable-table');
const tableContainer = document.querySelector('.table-container');
const resizeIndicator = document.querySelector('.resize-indicator');




 
 
let isResizing = false;
let currentColumn = null;
let startX, startWidth;
let DTId = 1;
 
 
 
// Function to render the DT table
function renderDTTable(data,status1="status") {
    const tableHead = document.querySelector('thead');
    tableHead.style.position = 'sticky';
    tableHead.style.top = '0';
    tableHead.style.zIndex = '2';
    const headerRow = document.createElement('tr');
 
    // Add Select column header
    const selectHeader = document.createElement('th');
    selectHeader.textContent = 'Select';
    headerRow.appendChild(selectHeader);
 
    data.columns.forEach((column, index) => {
        const th = document.createElement('th');
        th.setAttribute('scope', 'col');
        th.textContent = column.header;
        th.style.position = 'relative'; 
        th.style.overflow = 'hidden';
        th.style.whiteSpace = 'nowrap';
        th.style.textOverflow = 'ellipsis';
        th.style.paddingRight = '90px';
        

        const resizer = document.createElement('div');
        resizer.className = 'resizer';
        resizer.id = `resizer-${index}`;
 
        th.appendChild(resizer);
        
        // icons from b
        const iconContainer = document.createElement('div');
        iconContainer.className = 'icon-container';
        iconContainer.style.position = 'absolute';
        iconContainer.style.top = '50%';
        iconContainer.style.right = '5px';  // Position the icons to the right
        

        iconContainer.style.transform = 'translateY(-50%)';
        iconContainer.style.display = 'flex';
        iconContainer.style.alignItems = 'center';
 
        const sortIcon = document.createElement('i');
        sortIcon.className = 'bi bi-arrow-down';
        sortIcon.style.cursor = 'pointer';
        sortIcon.style.marginLeft = '5px'; // Space between icons
        column.sortDirection = 'asc';
 
        const filterIcon = document.createElement('i');
        filterIcon.className = 'bi bi-funnel';
        filterIcon.style.cursor = 'pointer';
        filterIcon.style.marginLeft = '5px'; // Space between icons
        filterIcon.onclick = () => handleFilter(column);    
        

        document.getElementById('close_modal').addEventListener('click', () => {
            const filterModal = bootstrap.Modal.getInstance(document.getElementById('filterModal'));
            filterModal.hide();
        });
        
        document.getElementById('applyFilter').addEventListener('click', () => {
            const filterModal = bootstrap.Modal.getInstance(document.getElementById('filterModal'));
            filterModal.hide();
            // Add any filter application logic here
        });

        document.getElementById('applyFilter').addEventListener('click', () => {
            const filterModal = bootstrap.Modal.getInstance(document.getElementById('filterModal'));
            filterModal.hide();
            // Add any filter application logic here
            const currentColumn = window.currentFilterColumn; // Store the current column globally when opening filter modal

            // Collect selected checkboxes
            const selectedValues = Array.from(document.querySelectorAll('.item-checkbox:checked'))
                .map(checkbox => checkbox.value);

            // If values are selected, filter and group
            if (selectedValues.length > 0) {
                const filteredDTs = Data.bodyel.filter(DT =>
                    selectedValues.includes(String(DT[currentColumn.key]))
                );

                reloaddata_filtered(filteredDTs);
            } else {
                // If no values selected, reload full data
                renderDTTable(Data);
            }
        });
        sortIcon.onclick = () => {
            if (column.sortState === 'none' || column.sortState === 'desc') {
                column.sortState = 'asc';
                sortIcon.className = 'bi bi-arrow-up';
            } else {
                column.sortState = 'desc';
                sortIcon.className = 'bi bi-arrow-down';
            }
 
            handleSort(column);
        };
 
        // filterIcon.onclick = () => handleFilter(column); // Implement handleFilter
 
        iconContainer.appendChild(sortIcon);
        iconContainer.appendChild(filterIcon);  // Add both icons
 
 
 

         // Append the icon container to the th
         th.appendChild(iconContainer);
         headerRow.appendChild(th);
 
        // Add resize event listeners
        resizer.addEventListener('mousedown', initResize);
        resizer.addEventListener('dblclick', handleDoubleClick);
    });
 
    tableHead.innerHTML = '';
    tableHead.appendChild(headerRow);
 
    const tableBody = document.querySelector('tbody');
    tableBody.innerHTML = '';
 
    data.bodyel.forEach(DT => {
        // const statusClass = {
        //     'Active': 'bg-success',
        //     'Inactive': 'bg-danger',
        //     'On Leave': 'bg-warning text-dark'
        // }[status];

    //     "status": {
    //     "Active": "green",
    //     "Graduated": "blue",
    //     "On Leave": "red",
    //     "Inactive": "yellow"
    // },



 
        const row = document.createElement('tr');
 
        // Add checkbox for selection
        const selectCell = document.createElement('td');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'select-row';
        selectCell.appendChild(checkbox);
        row.appendChild(selectCell);
 
        data.columns.forEach(column => {
            const cell = column.key === 'id' ? document.createElement('th') : document.createElement('td');
            if (column.key === 'id') {
                cell.setAttribute('scope', 'row');
            }
 
            // Create editable cell
            const cellContent = document.createElement('div');
            cellContent.textContent = DT[column.key];
            cellContent.className = 'cell-content';
            
            cellContent.addEventListener('click', () => editCell(cellContent, column.key, DT));
 
            if (column.key === status) {
                cell.innerHTML = `<span class="badge" style="background-color:${Data.status[Data.bodyel[index][column.key]]}">${Data.bodyel[index][column.key]}</span>`;
                alert(Data.status[Data.bodyel[index][column.key]]);
            } else {
                cell.appendChild(cellContent);
            }
 
            row.appendChild(cell);
        });
 
        tableBody.appendChild(row);
    });
 
    // Update DTId to the next available ID
    DTId = data.bodyel.length > 0 ? Math.max(...data.bodyel.map(emp => emp.id)) + 1 : 1;
}

function handleFilter(column) {
    window.currentFilterColumn = column;

    // Get unique column values
    const columnData = [...new Set(Data.bodyel.map(emp => emp[column.key]))].filter(item => 
        item !== null && item !== undefined
    ).sort((a, b) => String(a).localeCompare(String(b)));

    const modalBody = document.querySelector(".modal-body");
    modalBody.innerHTML = "";

    // Create compact filter container
    const filterContainer = document.createElement("div");
    filterContainer.classList.add("p-2");
    filterContainer.innerHTML = `
        <div class="row g-2 mb-2">
            <div class="col-6">
                <select class="form-select form-select-sm" id="filterTypeSelect">
                    <option value="exact">Exact</option>
                    <option value="startsWith">Starts</option>
                    <option value="endsWith">Ends</option>
                    <option value="contains">Contains</option>
                </select>
            </div>
            <div class="col-6">
                <input type="text" class="form-control form-control-sm" id="filterInput" placeholder="Filter">
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="selectAllCheckbox">
                <label class="form-check-label" for="selectAllCheckbox">All</label>
            </div>
            <div>
                <button class="btn btn-sm btn-outline-secondary me-1" id="deselectAllButton">Clear</button>
                <button class="btn btn-sm btn-outline-success" id="applyFilterBtn">Apply</button>
            </div>
        </div>
    `;

    // Create scrollable list container
    const listContainer = document.createElement("div");
    listContainer.classList.add("filter-list-container", "border", "rounded");
    listContainer.style.maxHeight = "200px";
    listContainer.style.overflowY = "auto";
    listContainer.style.paddingRight = "10px"; // Add some right padding

    // Populate list with checkboxes
    columnData.forEach(item => {
        const safeItem = String(item);
        const d = document.createElement("div");
        d.classList.add("filter-checkbox-wrapper", "d-flex", "align-items-center", "p-1", "border-bottom");
        
        // Create checkbox and label elements separately for better control
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.classList.add("form-check-input", "item-checkbox", "me-2");
        checkbox.id = safeItem;
        checkbox.value = safeItem;

        const label = document.createElement("label");
        label.classList.add("form-check-label", "flex-grow-1");
        label.htmlFor = safeItem;
        label.textContent = safeItem;

        // Append checkbox and label to the wrapper
        d.appendChild(checkbox);
        d.appendChild(label);

        listContainer.appendChild(d);
    });

    // Append list to container
    filterContainer.appendChild(listContainer);
    modalBody.appendChild(filterContainer);

    // Select All functionality
    document.getElementById("selectAllCheckbox").addEventListener("change", function () {
        document.querySelectorAll(".item-checkbox").forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });

    // Clear Filter functionality
    document.getElementById("deselectAllButton").addEventListener("click", function() {
        document.querySelectorAll('.item-checkbox').forEach(checkbox => {
            checkbox.checked = false;
        });
        document.getElementById("selectAllCheckbox").checked = false;
    });

    // Apply Filter functionality
    document.getElementById("applyFilterBtn").addEventListener("click", function() {
        const filterType = document.getElementById("filterTypeSelect").value;
        const filterValue = document.getElementById("filterInput").value.toLowerCase();

        // Get selected checkbox values
        const selectedValues = Array.from(
            document.querySelectorAll('.item-checkbox:checked')
        ).map(checkbox => checkbox.value);

        // Filter logic
        let filteredData = Data.bodyel.filter(item => {
            const columnValue = String(item[column.key]).toLowerCase();

            // Check checkbox selections first
            if (selectedValues.length > 0 && 
                !selectedValues.includes(String(item[column.key]))) {
                return false;
            }

            // Apply text filter if value is provided
            if (filterValue) {
                switch(filterType) {
                    case 'exact':
                        return columnValue === filterValue;
                    case 'startsWith':
                        return columnValue.startsWith(filterValue);
                    case 'contains':
                        return columnValue.includes(filterValue);
                    case 'endsWith':
                        return columnValue.endsWith(filterValue);
                }
            }

            return true;
        });

        // Reload filtered data
        reloaddata_filtered(filteredData);
        
        // Hide modal
        const filterModal = bootstrap.Modal.getInstance(document.getElementById("filterModal"));
        filterModal.hide();
    });

    // Show modal
    const filterModal = new bootstrap.Modal(document.getElementById("filterModal"));
    filterModal.show();
}




// function to reload data after sort
function reloaddata(data) {
    const tableBody = document.querySelector('tbody');
    tableBody.innerHTML = '';
 
    // This Additional functionality is not completed yet
    data.bodyel.forEach(DT => {
        const statusClass = {
            'Active': 'bg-success',
            'Inactive': 'bg-danger',
            'On Leave': 'bg-warning text-dark'
        }[DT.status];
 
        const row = document.createElement('tr');
 
        // Add checkbox for selection
        const selectCell = document.createElement('td');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'select-row';
        selectCell.appendChild(checkbox);
        row.appendChild(selectCell);
 
        data.columns.forEach(column => {
            const cell = column.key === 'id' ? document.createElement('th') : document.createElement('td');
            if (column.key === 'id') {
                cell.setAttribute('scope', 'row');
            }
 
            // Create editable cell
            const cellContent = document.createElement('div');
            cellContent.textContent = DT[column.key];
            cellContent.className = 'cell-content';
            cellContent.addEventListener('click', () => editCell(cellContent, column.key, DT));
 
            if (column.key === 'status') {
                if (column.key === status) {
                    cell.innerHTML = `<span class="badge" style="background-color:${Data.status[Data.bodyel[index][column.key]]}">${Data.bodyel[index][column.key]}</span>`;
                }
            } else {
                cell.appendChild(cellContent);
            }
 
            row.appendChild(cell);
        });
 
        tableBody.appendChild(row);
    });
 
}
 
//  function to sort column 

function reloaddata_filtered(DTs) {
    const tableBody = document.querySelector('tbody');
    tableBody.innerHTML = '';

    if (DTs && Array.isArray(DTs)) {
        DTs.forEach(DT => {
            const statusClass = {
                'Active': 'bg-success',
                'Inactive': 'bg-danger',
                'On Leave': 'bg-warning text-dark'
            }[DT.status];

            const row = document.createElement('tr');

            // Add checkbox for selection
            const selectCell = document.createElement('td');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'select-row';
            selectCell.appendChild(checkbox);
            row.appendChild(selectCell);

            Data.columns.forEach(column => {
                const cell = column.key === 'id' ? document.createElement('th') : document.createElement('td');
                if (column.key === 'id') {
                    cell.setAttribute('scope', 'row');
                }

                // Create editable cell
                const cellContent = document.createElement('div');
                cellContent.textContent = DT[column.key];
                cellContent.className = 'cell-content';
                cellContent.addEventListener('click', () => editCell(cellContent, column.key, DT));

                if (column.key === 'status') {
                    cell.innerHTML = `<span class="badge ${statusClass}">${DT[column.key]}</span>`;
                } else {
                    cell.appendChild(cellContent);
                }

                row.appendChild(cell);
            });

            tableBody.appendChild(row);
        });
    }
}
function groupBy(list, keyGetter) {
    const map = new Map();
    list.forEach((item) => {
        const key = keyGetter(item);
        const collection = map.get(key);
        if (!collection) {
            map.set(key, [item]);
        } else {
            collection.push(item);
        }
    });
    return map;
}

function group_keys(column) {
    const grouped_by_name = groupBy(Data.bodyel, DT => DT[column.key]);
    // console.log(grouped_by_name);
    return grouped_by_name.keys();
}

function sortAtoZ(column) {
    const key = column.key;
    Data.bodyel.sort((a, b) => {
        const aValue = a[key];
        const bValue = b[key];
        return aValue.localeCompare(bValue);
    });
}

function sortZtoA(column) {
    const key = column.key;
    Data.bodyel.sort((a, b) => {
        const aValue = a[key];
        const bValue = b[key];
        return bValue.localeCompare(aValue);
    });
}
function handleSort(column) {
    const key = column.key;
    const direction = column.sortState;
 
    Data.bodyel.sort((a, b) => {
        const aValue = a[key];
        const bValue = b[key];
 
        let comparisonResult;
        if (typeof aValue === 'string') {
            comparisonResult = aValue.localeCompare(bValue);
        } else {
            comparisonResult = aValue - bValue;
        }
 
        return direction === 'asc' ? comparisonResult : -comparisonResult;
    });
 
    // console.log(Data.DTs);
    reloaddata(Data);
}
 

// Function to edit a cell
function editCell(cellContent, key, DT) {
    // if the edit button not enabled dot edit
    if (!document.getElementById('editButton').disabled) {
       return;
    }
    const input = document.createElement('input');
    input.type = 'text'; // Customize input type as needed
    input.value = cellContent.textContent.trim();
    cellContent.innerHTML = ''; // Clear the cell content
    cellContent.appendChild(input);
    input.focus();
    editedCells.push({ cellContent, input, key, DT }); // Track the edited cell

    // Listen for "Enter" key to save changes
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            saveEdit(cellContent, input.value, key, DT);
        }
    });
}
 
// Function to save the edited value
function saveEdit(cellContent, newValue, key, DT) {
    if (newValue.trim() === "") return; // Do not save empty values
    cellContent.innerHTML = newValue; // Update the cell content
    DT[key] = newValue; // Update the DT data
    
    toggleButtons('update');
    // append to main data
   
    
}
 
// function to enable button based on any cell edited
function updateButtonState() {
    const updateButton = document.getElementById('updateButton');
    if (editedCells.length > 0) {
        updateButton.disabled = false; // Enable "Update" button if any cells are edited
    } else {
        updateButton.disabled = true; // Disable it if no cells are edited
    }
}
// made to add new row to main data
var newEntry = {};
function addDT() {

    const tableBody = document.querySelector('#resizable-table tbody');
    const newRow = document.createElement('tr');
    
    // Add checkbox for selection
    const selectCell = document.createElement('td');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'select-row';
    checkbox.checked = true; // Set the checkbox to be checked by default
    
    selectCell.appendChild(checkbox);
    newRow.appendChild(selectCell);
    
    // Add ID cell
    const idCell = document.createElement('th');
    idCell.textContent = DTId++;
    newRow.appendChild(idCell);
    newEntry={};
    newEntry.id =parseInt( idCell.textContent);
    
    // Add other columns
    Data.columns.forEach((column, index) => {
        if (index > 0) { // Skip the first column (ID)
            const cell = document.createElement('td');
            const div = document.createElement('div');
            div.className = 'cell-content';
            div.setAttribute('onclick', `editCell(this, '${column.key}', {})`);
            div.textContent = column.header || ' ';
            cell.appendChild(div);
            newRow.appendChild(cell);
            newEntry[column.key] = '';
        }
    });
    
    tableBody.appendChild(newRow);
}
 
// Initial rendering of the DT table
document.addEventListener('DOMContentLoaded', () => {
    renderDTTable(Data);
    autoFitAll();
});
 
 
 
function calculateOptimalWidth(columnIndex) {
    const cells = Array.from(table.querySelectorAll(`tr td:nth-child(${columnIndex + 1})`))
        .concat(Array.from(table.querySelectorAll(`tr th:nth-child(${columnIndex + 1})`)));
   
    const temp = document.createElement('div');
    temp.style.position = 'absolute';
    temp.style.visibility = 'hidden';
    temp.style.whiteSpace = 'nowrap';
    document.body.appendChild(temp);
   
    const maxWidth = cells.reduce((max, cell) => {
        temp.textContent = cell.textContent;
        const width = temp.offsetWidth;
        return Math.max(max, width);
    }, 0);
   
    document.body.removeChild(temp);
    return maxWidth + 40;
}
 
function autoFitColumn(columnIndex) {
    const optimalWidth = calculateOptimalWidth(columnIndex);
    const header = table.querySelector(`th:nth-child(${columnIndex + 1})`);
    header.style.width = `${optimalWidth}px`;
}
 
function autoFitAll() {
    const headers = table.querySelectorAll('th');
    headers.forEach((_, index) => autoFitColumn(index));
}
 
function resetColumns() {
    const headers = table.querySelectorAll('th');
    headers.forEach(header => header.style.width = '');
}
 
function initResize(e) {
    isResizing = true;
    currentColumn = e.target.parentElement;
    startX = e.pageX;
    startWidth = currentColumn.offsetWidth;
   
    // Calculate the initial position relative to the table container
    const tableRect = tableContainer.getBoundingClientRect();
    const initialX = e.pageX - tableRect.left + tableContainer.scrollLeft;  //Horizontal scroll position
   
    resizeIndicator.style.display = 'block';//Makes the resize indicator visible
    resizeIndicator.style.left = `${initialX}px`;
   
    document.addEventListener('mousemove', handleResize);
    document.addEventListener('mouseup', stopResize);
   
    // Add resizing class to the table container
    tableContainer.classList.add('resizing');
}
 
function handleResize(e) {
    if (!isResizing) return;
   
    // Calculate the position relative to the table container
    const tableRect = tableContainer.getBoundingClientRect();
    const x = e.pageX - tableRect.left + tableContainer.scrollLeft;
   
    const width = startWidth + (e.pageX - startX);
    if (width >= 100&&width<=500) {
        resizeIndicator.style.left = `${x}px`;
        currentColumn.style.width = `${width}px`;
    }
}
 
function stopResize() {
    if (!isResizing) return;
   
    isResizing = false;
    resizeIndicator.style.display = 'none';
   
    // Remove resizing class from the table container
    tableContainer.classList.remove('resizing');
   
    document.removeEventListener('mousemove', handleResize);
    document.removeEventListener('mouseup', stopResize);
}
 
function handleDoubleClick(e) {
    const header = e.target.parentElement;
    const columnIndex = Array.from(header.parentElement.children).indexOf(header);
    autoFitColumn(columnIndex);
}
 
document.addEventListener('DOMContentLoaded', () => {
    renderDTTable(Data);
    autoFitAll();
});


function deleteSelected() {
    const checkboxes = document.querySelectorAll('.select-row');
    
    // Check if any checkboxes are checked
    const checkedBoxes = Array.from(checkboxes).filter(checkbox => checkbox.checked);
    
    if (checkedBoxes.length === 0) {
        // alert('No rows selected for deletion');
        return;
    }
    
    toggleButtons('delete');
    const selectedIds = checkedBoxes.map(checkbox => {
        const row = checkbox.closest('tr');
        const idCell = row.querySelector('th'); // Assumes ID is in the first column
        return parseInt(idCell.textContent);
    });

    // Filter out DTs with selected IDs
    Data.bodyel = Data.bodyel.filter(
        DT => !selectedIds.includes(DT.id)
    );
    
    // update the main data here
    // console.log("+++++++++++++++++++++",Data.bodyel);
    renderDTTable(Data);
    
    // Reset button states
    toggleButtons('delete');
}
function toggleButtons(action) {
    const addButton = document.getElementById('addButton');
    const editButton = document.getElementById('editButton');
    const deleteButton = document.getElementById('deleteButton');
    const updateButton = document.getElementById('updateButton');
    const cancelButton = document.getElementById('cancelButton');

    switch (action) {
        case 'add':
            addButton.disabled = true;
            editButton.disabled = true;
            deleteButton.disabled = true;
            updateButton.disabled = false;
            cancelButton.disabled = false;
            break;
        case 'edit':
            addButton.disabled = true;
            editButton.disabled = true;
            deleteButton.disabled = true;
            updateButton.disabled = false;
            cancelButton.disabled = false;
            break;
        case 'delete':
            addButton.disabled = true;
            editButton.disabled = true;
            deleteButton.disabled = true;
            updateButton.disabled = false;
            cancelButton.disabled = false;
            break;
        case 'cancel':
            addButton.disabled = false;
            editButton.disabled = false;
            deleteButton.disabled = false;
            updateButton.disabled = true;
            cancelButton.disabled = true;
            break;
        case 'update':
            addButton.disabled = false;
            editButton.disabled = false;
            deleteButton.disabled = false;
            updateButton.disabled = true;
            cancelButton.disabled = true;
            break;
    }
}

let editedCells = [];

document.getElementById('addButton').addEventListener('click', function () {
    addDT();
    
    
    toggleButtons('add'); // Disable Add, Edit, Delete and enable Update, Cancel
});

document.getElementById('updateButton').addEventListener('click', () => {
    editedCells.forEach(({ cellContent, input, key, DT }) => {
        const newValue = input.value;
        if(newEntry['id'])
            newEntry[key] = newValue;
        saveEdit(cellContent, newValue, key, DT);
    });
    if (Object.keys(newEntry).length > 0) {
        Data.bodyel.push(newEntry);
        renderDTTable(Data);
        newEntry = {};
    }
    editedCells = []; // Clear the edited cells after update
    updateButtonState(); // Disable the "Update" button
    // toggleButtons('update');
});


document.getElementById('deleteButton').addEventListener('click', () => {
    deleteSelected();
    
}
);

document.getElementById('editButton').addEventListener('click', () => {
    toggleButtons('edit');
});


document.getElementById('cancelButton').addEventListener('click', () => {
    editedCells.forEach(({ cellContent, input }) => {
        // if input value is empty user prevous value
        if (input.value.trim() === "") {
            cellContent.innerHTML = cellContent.textContent;
        } else {
            cellContent.innerHTML = input.value;
        }
    });
    editedCells = []; // Clear the edited cells
    updateButtonState(); // Disable the "Update" button
    const addButton = document.getElementById('addButton');
    if(addButton.disabled){
        deleteSelected();
    }
        
    toggleButtons('cancel');
});